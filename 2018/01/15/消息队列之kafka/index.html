<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>消息队列之Kafka | 夏浅安のブログ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Kafka 特点Kafka 最早是由 LinkedIn 公司开发一种分布式的基于发布/订阅的消息系统，之后成为 Apache 的顶级项目。主要特点如下：">
<meta name="keywords" content="消息中间件">
<meta property="og:type" content="article">
<meta property="og:title" content="消息队列之Kafka">
<meta property="og:url" content="http://github.com/b2stry/2018/01/15/消息队列之kafka/index.html">
<meta property="og:site_name" content="夏浅安のブログ">
<meta property="og:description" content="Kafka 特点Kafka 最早是由 LinkedIn 公司开发一种分布式的基于发布/订阅的消息系统，之后成为 Apache 的顶级项目。主要特点如下：">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1516020536315&di=0d653bef90e207015d33d3efb26a999f&imgtype=0&src=http%3A%2F%2Fimg.25pp.com%2Fuploadfile%2Fapp%2Ficon%2F20160405%2F1459846305454376.jpg">
<meta property="og:updated_time" content="2018-02-03T07:36:43.342Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="消息队列之Kafka">
<meta name="twitter:description" content="Kafka 特点Kafka 最早是由 LinkedIn 公司开发一种分布式的基于发布/订阅的消息系统，之后成为 Apache 的顶级项目。主要特点如下：">
<meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1516020536315&di=0d653bef90e207015d33d3efb26a999f&imgtype=0&src=http%3A%2F%2Fimg.25pp.com%2Fuploadfile%2Fapp%2Ficon%2F20160405%2F1459846305454376.jpg">
    

    

    
        <link rel="icon" href="/images/yu.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?865692d8325f5ebc46f2007ac5a4f929";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
	
})();
</script>

    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
               
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/images/mianbao.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/images/mianbao.png" />
            <h2 id="name">ShallowAn</h2>
            <h3 id="title">世界远比你想象的更精彩,<br>别放弃!</h3>
            <span id="location"><i class="fa fa-map-marker"></i>中国, 长沙</span>
            <a style="margin:20px 50px 10px" id="follow" target="_blank" href="https://github.com/b2stry/">关注</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                45
                <span>文章</span>
            </div>
            <div class="article-info-block">
                38
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://main.shallowan.cn" target="_blank" title="home" class=tooltip>
                            <i class="fa fa-home"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://47.93.242.254:8888/mytwitter/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://weibo.com/shallowAn" target="_blank" title="weibo" class=tooltip>
                            <i class="fa fa-weibo"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.linkedin.com/in/%E9%9C%88-%E5%88%98-250b7b152/" target="_blank" title="linkedin" class=tooltip>
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="javascript:window.open('http://www.shallowan.cn/imgrepo/wechatcode.png')" target="_blank" title="weixin" class=tooltip>
                            <i class="fa fa-weixin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://github.com/b2stry/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-消息队列之kafka" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            
	
		<img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1516020474249&di=e33e7e85057bb1b53f31ec54b759ba2c&imgtype=0&src=http%3A%2F%2Fhortonworks.com%2Fwp-content%2Fuploads%2F2014%2F08%2Fkafka-logo-wide.png" class="article-banner" />
	



        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            消息队列之Kafka
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/01/15/消息队列之kafka/">
            <time datetime="2018-01-15T09:58:50.000Z" itemprop="datePublished">2018-01-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/kafka/">kafka</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/消息中间件/">消息中间件</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="Kafka-特点"><a href="#Kafka-特点" class="headerlink" title="Kafka 特点"></a>Kafka 特点</h2><p>Kafka 最早是由 LinkedIn 公司开发一种分布式的基于发布/订阅的消息系统，之后成为 Apache 的顶级项目。主要特点如下：<br><a id="more"></a><br>  1)  同时为发布和订阅提供高吞吐量<br>    Kafka 的设计目标是以时间复杂度为 O(1) 的方式提供消息持久化能力，即使对TB 级以上数据也能保证常数时间的访问性能。即使在非常廉价的商用机器上也能做到单机支持每秒 100K 条消息的传输。</p>
<p>  2)  消息持久化<br>    将消息持久化到磁盘，因此可用于批量消费，例如 ETL 以及实时应用程序。通过将数据持久化到硬盘以及 replication 防止数据丢失。</p>
<p>  3)  分布式<br>    支持 Server 间的消息分区及分布式消费，同时保证每个 partition 内的消息顺序传输。这样易于向外扩展，所有的producer、broker 和 consumer 都会有多个，均为分布式的。无需停机即可扩展机器。</p>
<p>  4)  消费消息采用 pull 模式<br>    消息被处理的状态是在 consumer 端维护，而不是由 server 端维护，broker 无状态，consumer 自己保存 offset。</p>
<p>支持 online 和 offline 的场景。</p>
<p>同时支持离线数据处理和实时数据处理。</p>
<h2 id="Kafka-中的基本概念"><a href="#Kafka-中的基本概念" class="headerlink" title="Kafka 中的基本概念"></a>Kafka 中的基本概念</h2><p><img src="https://upload-images.jianshu.io/upload_images/5015984-e447d1643b52788d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/636" alt=""></p>
<p>1) Broker<br><br>Kafka 集群中的一台或多台服务器统称为 Broker</p>
<p>2) Topic<br><br>每条发布到 Kafka 的消息都有一个类别，这个类别被称为 Topic 。（物理上不同<br>Topic 的消息分开存储。逻辑上一个 Topic 的消息虽然保存于一个或多个broker上，但用户只需指定消息的 Topic 即可生产或消费数据而不必关心数据存于何处）</p>
<p>3) Partition<br><br>Topic 物理上的分组，一个 Topic 可以分为多个 Partition ，每个 Partition 是一个有序的队列。Partition 中的每条消息都会被分配一个有序的 id（offset）</p>
<p>4) Producer<br><br>消息和数据的生产者，可以理解为往 Kafka 发消息的客户端</p>
<p>5) Consumer<br><br>消息和数据的消费者，可以理解为从 Kafka 取消息的客户端</p>
<p>6) Consumer Group<br><br>每个 Consumer 属于一个特定的 Consumer Group（可为每个 Consumer 指定Group Name，若不指定 Group Name 则属于默认的 Group）。</p>
<p>这是 Kafka 用来实现一个 Topic 消息的广播（发给所有的 Consumer ）和单播（发给任意一个 Consumer ）的手段。一个 Topic 可以有多个 Consumer Group。Topic 的消息会复制（不是真的复制，是概念上的）到所有的 Consumer Group，但每个 Consumer Group 只会把消息发给该 Consumer Group 中的一个 Consumer。如果要实现广播，只要每个 Consumer 有一个独立的 Consumer Group 就可以了。如果要实现单播只要所有的 Consumer 在同一个 Consumer Group 。用 Consumer Group 还可以将 Consumer 进行自由的分组而不需要多次发送消息到不同的 Topic 。</p>
<h2 id="Kafka-安装"><a href="#Kafka-安装" class="headerlink" title="Kafka 安装"></a>Kafka 安装</h2><p>Mac 用户用 HomeBrew 来安装，安装前要先更新 brew<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew update</div></pre></td></tr></table></figure></p>
<p>接着安装 kafka<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install kafka</div></pre></td></tr></table></figure></p>
<p>安装完成之后可以查看 kafka 的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/etc/kafka</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-96788e7b3b797174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="kafka 配置文件"></p>
<p>我的电脑通过 HomeBrew 安装的 kafka 位置在 /usr/local/Cellar/kafka/0.11.0.1/bin ，可以看到 HomeBrew 安装下来的 kafka 的版本已经是 0.11.0.1 的了。</p>
<p>kafka 需要用到 zookeeper，HomeBrew 安装kafka 的时候会同时安装 zookeeper。下面先启动 zookeeper：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</div></pre></td></tr></table></figure></p>
<p>接着启动 kafka<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1</div><div class="line">./bin/kafka-server-start /usr/local/etc/kafka/server.properties</div></pre></td></tr></table></figure></p>
<p>创建 topic，设置 partition 数量为2，topic 的名字叫 test-topic，下面的例子都用这个 topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1</div><div class="line">./bin/kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 2 --topic test-topic</div></pre></td></tr></table></figure></p>
<p>查看创建的 topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1</div><div class="line">./bin/kafka-topics --list --zookeeper localhost:2181</div></pre></td></tr></table></figure></p>
<h2 id="Kafka-命令行测试"><a href="#Kafka-命令行测试" class="headerlink" title="Kafka 命令行测试"></a>Kafka 命令行测试</h2><p>发送消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1/bin</div><div class="line">kafka-console-producer --broker-list localhost:9092 --topic test-topic</div></pre></td></tr></table></figure></p>
<p>消费消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1/bin</div><div class="line">kafka-console-consumer --bootstrap-server localhost:9092 --topic test-topic --from-beginning</div></pre></td></tr></table></figure></p>
<p>删除 topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1/bin</div><div class="line">./bin/kafka-topics --delete --zookeeper localhost:2181 --topic test-topic</div></pre></td></tr></table></figure></p>
<p>如果 kafka 启动时加载的配置文件中 server.properties 没有配置delete.topic.enable=true，那么此时的删除并不是真正的删除，而是把 topic 标记为：marked for deletion</p>
<p>可以通过命令来查看所有 topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/kafka/0.11.0.1/bin</div><div class="line">./bin/kafka-topics --zookeeper localhost:2181 --list</div></pre></td></tr></table></figure></p>
<p>如果想真正删除它，可以如下操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">登录zookeeper客户端：/usr/local/Cellar/zookeeper/3.4.10/bin/zkCli</div><div class="line">找到topic所在的目录：ls /brokers/topics</div><div class="line">找到要删除的topic，执行命令：rmr /brokers/topics/test-topic 即可，此时topic被彻底删除</div></pre></td></tr></table></figure></p>
<h2 id="Java-客户端访问"><a href="#Java-客户端访问" class="headerlink" title="Java 客户端访问"></a>Java 客户端访问</h2><p>1) maven工程的pom文件中添加依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.11.0.1&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>2) 消息生产者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">package org.study.kafka;</div><div class="line"></div><div class="line">import org.apache.kafka.clients.producer.KafkaProducer;</div><div class="line">import org.apache.kafka.clients.producer.Producer;</div><div class="line">import org.apache.kafka.clients.producer.ProducerRecord;</div><div class="line"></div><div class="line">import java.util.HashMap;</div><div class="line">import java.util.Map;</div><div class="line"></div><div class="line">public class ProducerSample &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Map&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();</div><div class="line">        props.put(&quot;zk.connect&quot;, &quot;127.0.0.1:2181&quot;);//zookeeper 的地址</div><div class="line">        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);//用于建立与 kafka 集群连接的 host/port 组。</div><div class="line">        props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</div><div class="line">        props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</div><div class="line">        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</div><div class="line">        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</div><div class="line"></div><div class="line">        String topic = &quot;test-topic&quot;;</div><div class="line">        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(props);</div><div class="line">        producer.send(new ProducerRecord&lt;String, String&gt;(topic, &quot;idea-key2&quot;, &quot;java-message 1&quot;));</div><div class="line">        producer.send(new ProducerRecord&lt;String, String&gt;(topic, &quot;idea-key2&quot;, &quot;java-message 2&quot;));</div><div class="line">        producer.send(new ProducerRecord&lt;String, String&gt;(topic, &quot;idea-key2&quot;, &quot;java-message 3&quot;));</div><div class="line"></div><div class="line">        producer.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3) 消息消费者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">package org.study.kafka;</div><div class="line"></div><div class="line">import org.apache.kafka.clients.consumer.Consumer;</div><div class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</div><div class="line">import org.apache.kafka.clients.consumer.ConsumerRecords;</div><div class="line">import org.apache.kafka.clients.consumer.KafkaConsumer;</div><div class="line"></div><div class="line">import java.util.Arrays;</div><div class="line">import java.util.Properties;</div><div class="line"></div><div class="line">public class ConsumerSample &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        String topic = &quot;test-topic&quot;;// topic name</div><div class="line"></div><div class="line">        Properties props = new Properties();</div><div class="line">        props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);//用于建立与 kafka 集群连接的 host/port 组。</div><div class="line">        props.put(&quot;group.id&quot;, &quot;testGroup1&quot;);// Consumer Group Name</div><div class="line">        props.put(&quot;enable.auto.commit&quot;, &quot;true&quot;);// Consumer 的 offset 是否自动提交</div><div class="line">        props.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;);// 自动提交 offset 到 zookeeper 的时间间隔，时间是毫秒</div><div class="line">        props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</div><div class="line">        props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</div><div class="line">        Consumer&lt;String, String&gt; consumer = new KafkaConsumer(props);</div><div class="line">        consumer.subscribe(Arrays.asList(topic));</div><div class="line">        while (true) &#123;</div><div class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);</div><div class="line">            for (ConsumerRecord&lt;String, String&gt; record : records)</div><div class="line">                System.out.printf(&quot;partition = %d, offset = %d, key = %s, value = %s%n&quot;, record.partition(), record.offset(), record.key(), record.value());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4) 启动 zookeeper<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</div></pre></td></tr></table></figure></p>
<p>5) 启动 kafka 服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-server-start /usr/local/etc/kafka/server.properties</div></pre></td></tr></table></figure></p>
<p>6) 运行 Consumer<br><br>先运行 Consumer ，这样当生产者发送消息的时候能在消费者后端看到消息记录。</p>
<p>7) 运行 Producer<br><br>运行 Producer，发布几条消息，在 Consumer 的控制台能看到接收的消息<br><img src="https://upload-images.jianshu.io/upload_images/5015984-a942182a87cb3929.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="Consumer 控制台"></p>
<h2 id="Kafka-集群配置"><a href="#Kafka-集群配置" class="headerlink" title="Kafka 集群配置"></a>Kafka 集群配置</h2><p>kafka 的集群配置一般有三种，即： single node - single broker ，single node - multiple broker ，multiple node - multiple broker</p>
<p>前两种实际上<a href="https://link.jianshu.com/?t=http%3A%2F%2Fkafka.apache.org%2F0110%2Fdocumentation.html%23quickstart" target="_blank">官网有介绍</a>。</p>
<ul>
<li>single node - single broker</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-a1c5f682e7532ffe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/530" alt="单节点单 broker"></p>
<p>1) 启动 zookeeper<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</div></pre></td></tr></table></figure></p>
<p>2) 启动 kafka broker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-server-start /usr/local/etc/kafka/server.properties</div></pre></td></tr></table></figure></p>
<p>3) 创建一个 kafka topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 2 --topic topic-singlenode-singlebroker</div></pre></td></tr></table></figure></p>
<p>4) 启动 producer 发送信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-producer --broker-list localhost:9092 --topic topic-singlenode-singlebroker</div></pre></td></tr></table></figure></p>
<p>broker-list 和 topic 这两个参数是必须的，broker-list 指定要连接的 broker 的地址，格式为 node_address:port 。topic 是必须的，因为需要发送消息给订阅了该<br>topic 的 consumer group 。</p>
<p>现在可以在命令行里输入一些信息，每一行会被作为一个消息。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-9767c36f6b425e68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="发送消息"></p>
<p>5) 启动 consumer 消费消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-consumer --bootstrap-server localhost:9092 --topic topic-singlenode-singlebroker</div></pre></td></tr></table></figure></p>
<p>在不同的终端窗口里分别启动 zookeeper、broker、producer、consumer 后，在<br>producer 终端里输入消息，消息就会在 consumer 终端中显示了。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-197223d8d1f23b22.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="消息显示"></p>
<ul>
<li>single node - multiple broker</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-a56e71d74199ab10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/530" alt="单节点多 broker"></p>
<p>1) 启动 zookeeper<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</div></pre></td></tr></table></figure></p>
<p>2) 启动broker</p>
<p>如果需要在单个节点（即一台机子）上面启动多个 broker（这里作为例子启动三个 broker），需要准备多个server.properties文件即可，所以需要复制 /usr/local/etc/kafka/server.properties 文件。因为需要为每个 broker 指定单独的属性配置文件，其中 broker.id 、 port 、 log.dir 这三个属性必须是不同的。</p>
<p>新建一个 kafka-example 目录和三个存放日志的目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir kafka-example</div><div class="line">mkdir kafka-logs-1</div><div class="line">mkdir kafka-logs-2</div><div class="line">mkdir kafka-logs-3</div></pre></td></tr></table></figure></p>
<p>复制 /usr/local/etc/kafka/server.properties 文件三份<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cp server.properties /Users/niwei/Downloads/kafka-example/server-1.properties</div><div class="line">cp server.properties /Users/niwei/Downloads/kafka-example/server-2.properties</div><div class="line">cp server.properties /Users/niwei/Downloads/kafka-example/server-3.properties</div></pre></td></tr></table></figure></p>
<p>在 broker1 的配置文件 server-1.properties 中，相关要修改的参数为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">broker.id=1</div><div class="line">port=9093</div><div class="line">log.dirs=/Users/niwei/Downloads/kafka-example/kafka-logs-1</div></pre></td></tr></table></figure></p>
<p>broker2 的配置文件 server-2.properties 中，相关要修改的参数为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">broker.id=2</div><div class="line">port=9094</div><div class="line">log.dirs=/Users/niwei/Downloads/kafka-example/kafka-logs-2</div></pre></td></tr></table></figure></p>
<p>broker3 的配置文件 server-3.properties 中，相关要修改的参数为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">broker.id=3</div><div class="line">port=9095</div><div class="line">log.dirs=/Users/niwei/Downloads/kafka-example/kafka-logs-3</div></pre></td></tr></table></figure></p>
<p>启动每个 broker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /Users/niwei/Downloads/kafka-example</div><div class="line">kafka-server-start server-1.properties</div><div class="line">kafka-server-start server-2.properties</div><div class="line">kafka-server-start server-3.properties</div></pre></td></tr></table></figure></p>
<p>3) 创建 topic</p>
<p>创建一个名为 topic-singlenode-multiplebroker 的topic<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-topics --create --zookeeper localhost:2181 --replication-factor 3 --partitions 1 --topic topic-singlenode-multiplebroker</div></pre></td></tr></table></figure></p>
<p>4) 启动 producer 发送信息<br>如果一个 producer 需要连接多个 broker 则需要传递参数 broker-list<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-producer --broker-list localhost:9093, localhost:9094, localhost:9095 --topic topic-singlenode-multiplebroker</div></pre></td></tr></table></figure></p>
<p>5) 启动 consumer 消费消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-consumer --zookeeper localhost:2181 --topic topic-singlenode-multiplebroker</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-fa8dcd2c131a5692.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="单节点多 broker 消费消息"></p>
<ul>
<li>multiple node - multiple broker<br><img src="https://upload-images.jianshu.io/upload_images/5015984-e7c461fb33427a73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/530" alt="多节点多 broker"></li>
</ul>
<p>在多节点多 broker 集群中，每个节点都需要安装 Kafka，且所有的 broker 都连接到同一个 zookeeper 。这里 zookeeper 当然也是可以配置成集群方式的，具体步骤参见我之前写的<a href="https://www.jianshu.com/p/286079c634fb" target="_blank">搭建 zookeeper 集群</a>。</p>
<p>1) Kafka 的集群配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">broker.id=1  #当前机器在集群中的唯一标识</div><div class="line">port=9093 #当前 kafka 对外提供服务的端口，默认是 9092</div><div class="line">host.name=192.168.121.101 #这个参数默认是关闭的，在0.8.1有个bug，DNS解析问题，失败率的问题。</div><div class="line">log.dirs=/Users/niwei/Downloads/kafka-example/kafka-logs-1 #消息存放的目录，这个目录可以配置为逗号分割的表达式</div><div class="line">zookeeper.connect=192.168.120.101:2181,192.168.120.102:2181,192.168.120.103:2181 #设置 zookeeper 集群的连接端口</div><div class="line"></div><div class="line">num.network.threads=3 #这个是 borker 进行网络处理的线程数</div><div class="line">num.io.threads=5 #这个是 borker 进行 IO 处理的线程数</div><div class="line">socket.send.buffer.bytes=102400 #发送缓冲区的大小，数据先回存储到缓冲区了到达一定的大小后在发送能提高性能</div><div class="line">socket.receive.buffer.bytes=102400 #接收缓冲区的大小，当数据到达一定大小后在序列化到磁盘</div><div class="line">socket.request.max.bytes=104857600 #这个参数是向 kafka 请求消息或者向 kafka 发送消息的请求的最大数，这个值不能超过 jvm 的堆栈大小</div><div class="line">num.partitions=1 #默认的分区数，一个 topic 默认1个分区数</div><div class="line">log.retention.hours=24 #默认消息的最大持久化时间，24小时</div><div class="line">message.max.byte=5242880  #消息保存的最大值5M</div><div class="line">default.replication.factor=2  #kafka 保存消息的副本数，如果一个副本失效了，另一个还可以继续提供服务</div><div class="line">replica.fetch.max.bytes=5242880  #取消息的最大直接数</div><div class="line">log.segment.bytes=1073741824 #这个参数是因为 kafka 的消息是以追加的形式落地到文件，当超过这个值的时候，kafka 会新建一个文件</div><div class="line">log.retention.check.interval.ms=300000 #每隔 300000 毫秒去检查上面配置的 log 失效时间（log.retention.hours=24 ），到目录查看是否有过期的消息如果有则删除</div><div class="line">log.cleaner.enable=false #是否启用 log 压缩，一般不用启用，启用的话可以提高性能</div></pre></td></tr></table></figure></p>
<p>由于是多节点多 broker 的，所以每个 broker 的配置文件 server.properties 都要按以上说明修改</p>
<p>2) producer 的配置修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-producer --broker-list 192.168.21.1:9092,192.168.21.2:9092,192.168.21.3:9092 --topic topic-multiplenode-multiplebroker</div></pre></td></tr></table></figure></p>
<p>3) consumer 的配置修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka-console-consumer --zookeeper 192.168.120.101:2181,192.168.120.102:2181,192.168.120.103:2181 --topic topic-multiplenode-multiplebroker</div></pre></td></tr></table></figure></p>
<h2 id="Kafka-高可靠性配置"><a href="#Kafka-高可靠性配置" class="headerlink" title="Kafka 高可靠性配置"></a>Kafka 高可靠性配置</h2><p>Kafka 提供了很高的数据冗余弹性，对于需要数据高可靠性的场景可以增加数据冗余备份数（replication.factor），调高最小写入副本数的个数（min.insync.replicas）等等，但是这样会影响性能。反之，性能提高而可靠性则降低，用户需要自身业务特性在彼此之间做一些权衡性选择。</p>
<p>要保证数据写入到 Kafka 是安全的、高可靠的，需要如下的配置：</p>
<p>1) topic 的配置<br><br>replication.factor&gt;=3，即副本数至少是3个2&lt;=min.insync.replicas&lt;=replication.factor<br>2) broker 的配置<br><br>leader 的选举条件 unclean.leader.election.enable=false<br>3) producer 的配置<br><br>request.required.acks=-1，producer.type=sync</p>
<h2 id="Kafka-高吞吐量的秘诀"><a href="#Kafka-高吞吐量的秘诀" class="headerlink" title="Kafka 高吞吐量的秘诀"></a>Kafka 高吞吐量的秘诀</h2><p>消息中间件从功能上看就是写入数据、读取数据两大类，优化也可以从这两方面来看。</p>
<p>为了优化写入速度 Kafak 采用以下技术：</p>
<p>1) 顺序写入</p>
<p>磁盘大多数都还是机械结构（SSD不在讨论的范围内），如果将消息以随机写的方式存入磁盘，就需要按柱面、磁头、扇区的方式寻址，缓慢的机械运动（相对内存）会消耗大量时间，导致磁盘的写入速度与内存写入速度差好几个数量级。为了规避随机写带来的时间消耗，Kafka 采取了顺序写的方式存储数据，如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-09720921fb1e5d36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600" alt="顺序写"></p>
<p>每条消息都被append 到该 partition 中，属于顺序写磁盘，因此效率非常高。</p>
<p>但这种方法有一个缺陷：没有办法删除数据。所以Kafka是不会删除数据的，它会把所有的数据都保留下来，每个消费者（Consumer）对每个 Topic 都有一个</p>
<p>offset 用来表示读取到了第几条数据。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-e4342beebb688ffb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/519" alt="消费消息"></p>
<p>上图中有两个消费者，Consumer1 有两个 offset 分别对应 Partition0、Partition1（假设每一个 Topic 一个 Partition ）。Consumer2 有一个 offset 对应Partition2 。这个 offset 是由客户端 SDK 保存的，Kafka 的 Broker 完全无视这个东西的存在，一般情况下 SDK 会把它保存到 zookeeper 里面。</p>
<p>如果不删除消息，硬盘肯定会被撑满，所以 Kakfa 提供了两种策略来删除数据。一是基于时间，二是基于 partition 文件大小，具体配置可以参看它的配置文档。</p>
<p>即使是顺序写，过于频繁的大量小 I/O 操作一样会造成磁盘的瓶颈，所以 Kakfa 在此处的处理是把这些消息集合在一起批量发送，这样减少对磁盘 I/O 的过度操作，而不是一次发送单个消息。</p>
<p>2) 内存映射文件<br>即便是顺序写入硬盘，硬盘的访问速度还是不可能追上内存。所以 Kafka 的数据并不是实时的写入硬盘，它充分利用了现代操作系统分页存储来利用内存提高I/O效率。Memory Mapped Files （后面简称mmap）也被翻译成内存映射文件，在64位操作系统中一般可以表示 20G 的数据文件，它的工作原理是直接利用操作系统的 Page 来实现文件到物理内存的直接映射。完成映射之后对物理内存的操作会被同步到硬盘上（由操作系统在适当的时候）。</p>
<p>通过 mmap 进程像读写硬盘一样读写内存，也不必关心内存的大小，有虚拟内存为我们兜底。使用这种方式可以获取很大的 I/O 提升，因为它省去了用户空间到内核空间复制的开销（调用文件的 read 函数会把数据先放到内核空间的内存中，然后再复制到用户空间的内存中）</p>
<p>但这样也有一个很明显的缺陷——不可靠，写到 mmap 中的数据并没有被真正的写到硬盘，操作系统会在程序主动调用 flush 的时候才把数据真正的写到硬盘。所以 Kafka 提供了一个参数—— producer.type 来控制是不是主动 flush，如果Kafka 写入到 mmap 之后就立即 flush 然后再返回 Producer 叫同步(sync)；如果写入 mmap 之后立即返回，Producer 不调用 flush ，就叫异步(async)。</p>
<p>3) 标准化二进制消息格式<br>为了避免无效率的字节复制，尤其是在负载比较高的情况下影响是显著的。为了避免这种情况，Kafka 采用由 Producer，Broker 和 Consumer 共享的标准化二进制消息格式，这样数据块就可以在它们之间自由传输，无需转换，降低了字节复制的成本开销。</p>
<p>而在读取速度的优化上 Kafak 采取的主要是零拷贝</p>
<p>1) 零拷贝（Zero Copy）的技术：<br><br>传统模式下我们从硬盘读取一个文件是这样的</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-82ed16f8ea147a14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/476" alt="文件传输到 Socket 的常规方式"></p>
<p>（1）操作系统将数据从磁盘读到内核空间的页缓存区</p>
<p>（2）应用将数据从内核空间读到用户空间的缓存中</p>
<p>（3）应用将数据写会内核空间的套接字缓存中</p>
<p>（4）操作系统将数据从套接字缓存写到网卡缓存中，以便将数据经网络发出</p>
<p>这样做明显是低效的，这里有四次拷贝，两次系统调用。</p>
<p>针对这种情况 Unix 操作系统提供了一个优化的路径，用于将数据从页缓存区传输到 socket。在 Linux 中，是通过 sendfile 系统调用来完成的。Java提供了访问这个系统调用的方法：FileChannel.transferTo API。这种方式只需要一次拷贝：操作系统将数据直接从页缓存发送到网络上，在这个优化的路径中，只有最后一步将数据拷贝到网卡缓存中是需要的。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5015984-75e6215c173708ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/350" alt="零拷贝方式传输到 Socket"></p>
<p>这个技术其实非常普遍，The C10K problem 里面也有很详细的介绍，Nginx 也是用的这种技术，稍微搜一下就能找到很多资料。</p>
<p>Kafka 速度的秘诀在于它把所有的消息都变成一个的文件。通过 mmap 提高 I/O 的速度，写入数据的时候是末尾添加所以速度最优；读取数据的时候配合sendfile 直接暴力输出。所以单纯的去测试 MQ 的速度没有任何意义，Kafka 的这种暴力的做法已经脱了 MQ 的底裤，更像是一个暴力的数据传送器。</p>
<blockquote>
<p>作者：预流<br>链接：<a href="https://www.jianshu.com/p/2c4caed49343" target="_blank" rel="external">https://www.jianshu.com/p/2c4caed49343</a><br>來源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://github.com/b2stry/2018/01/15/消息队列之kafka/" data-id="cjn11yq48003gqsqeukefvyty" class="article-share-link"><i class="fa fa-share"></i>分享</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/01/16/Thymeleaf-3学习笔记/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Thymeleaf 3学习笔记
                
            </div>
        </a>
    
    
        <a href="/2018/01/15/SpringMVC-测试-mockMVC/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">SpringMVC 测试 mockMVC</div>
        </a>
    
</nav>


    
</article>


    
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/9420/04/02/《阿里感悟》如何在三年内成长为一名技术专家？/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/读书/">读书</a></p>
                            <p class="item-title"><a href="/9420/04/02/《阿里感悟》如何在三年内成长为一名技术专家？/" class="title">【置顶】《阿里感悟》如何在三年内成长为一名技术专家？</a></p>
                            <p class="item-date"><time datetime="9420-04-02T07:14:07.000Z" itemprop="datePublished">9420-04-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/08/Quartz/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Quartz/">Quartz</a></p>
                            <p class="item-title"><a href="/2018/08/08/Quartz/" class="title">Quartz</a></p>
                            <p class="item-date"><time datetime="2018-08-08T12:06:28.000Z" itemprop="datePublished">2018-08-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/07/26/Navicat常用快捷键及注意事项/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/navicat/">navicat</a></p>
                            <p class="item-title"><a href="/2018/07/26/Navicat常用快捷键及注意事项/" class="title">Navicat常用快捷键及注意事项</a></p>
                            <p class="item-date"><time datetime="2018-07-26T06:39:36.000Z" itemprop="datePublished">2018-07-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/07/11/不止代码/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/不止代码/">不止代码</a></p>
                            <p class="item-title"><a href="/2018/07/11/不止代码/" class="title">不止代码</a></p>
                            <p class="item-date"><time datetime="2018-07-11T07:58:12.000Z" itemprop="datePublished">2018-07-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/03/21/远程通信的几种选择/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/远程通信/">远程通信</a></p>
                            <p class="item-title"><a href="/2018/03/21/远程通信的几种选择/" class="title">远程通信的几种选择</a></p>
                            <p class="item-date"><time datetime="2018-03-21T14:19:26.000Z" itemprop="datePublished">2018-03-21</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ajax/">Ajax</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Js/">Js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Quartz/">Quartz</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Boot/">Spring Boot</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/activemq/">activemq</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/command/">command</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fetch/">fetch</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hash/">hash</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/interview/">interview</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jsr303/">jsr303</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/navicat/">navicat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rabbitmq/">rabbitmq</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/regex/">regex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/swagger/">swagger</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/thymeleaf/">thymeleaf</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tomcat调优/">tomcat调优</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/不止代码/">不止代码</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息中间件/">消息中间件</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/远程通信/">远程通信</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/集群/">集群</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/集群/分布式/">分布式</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/集群/分布式/云计算/">云计算</a><span class="category-list-count">1</span></li></ul></li></ul></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/9420/04/">April 9420</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ajax/">Ajax</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/">JSP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quartz/">Quartz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fetch/">fetch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hash/">hash</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsr303/">jsr303</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/navicat/">navicat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/">swagger</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thymeleaf/">thymeleaf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat调优/">tomcat调优</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一键评教/">一键评教</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/不止代码/">不止代码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/云计算/">云计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则表达式/">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息中间件/">消息中间件</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机网络/">计算机网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/远程通信/">远程通信</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集群/">集群</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Ajax/" style="font-size: 13.33px;">Ajax</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/Spring-Boot/" style="font-size: 16.67px;">Spring Boot</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/fetch/" style="font-size: 10px;">fetch</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hash/" style="font-size: 10px;">hash</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/jsr303/" style="font-size: 10px;">jsr303</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/navicat/" style="font-size: 10px;">navicat</a> <a href="/tags/python/" style="font-size: 13.33px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/shell/" style="font-size: 13.33px;">shell</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/thymeleaf/" style="font-size: 10px;">thymeleaf</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/tomcat调优/" style="font-size: 10px;">tomcat调优</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/一键评教/" style="font-size: 10px;">一键评教</a> <a href="/tags/不止代码/" style="font-size: 10px;">不止代码</a> <a href="/tags/云计算/" style="font-size: 10px;">云计算</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/消息中间件/" style="font-size: 20px;">消息中间件</a> <a href="/tags/算法/" style="font-size: 13.33px;">算法</a> <a href="/tags/计算机网络/" style="font-size: 10px;">计算机网络</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a> <a href="/tags/远程通信/" style="font-size: 10px;">远程通信</a> <a href="/tags/集群/" style="font-size: 10px;">集群</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">友情链接(排名不分先后)</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a target="_blank" href="http://ifeve.com/">并发编程网</a>
                    </li>
                
                    <li>
                        <a target="_blank" href="http://www.sivan0222.cn">吴晓文</a>
                    </li>
                
                    <li>
                        <a target="_blank" href="http://www.rxdonny.com">唐仁鑫</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<footer id="footer">
	
    <div class="outer">
    	<a target="_blank" href="https://github.com/b2stry"><span class="fa-stack fa-lg">
                                <i class="fa fa-github fa-stack-2x fa-inverse" style="color:#898d92"></i></span></a>
        <div id="footer-info" class="inner">
            Copyright&nbsp;&copy; 2018 <a href="https://github.com/B2stry" target="_blank">Shallow An</a>  &nbsp;&nbsp;<br><span id="busuanzi_container_site_pv" style="font-size:13px"> 
  		pv: <span id="busuanzi_value_site_pv" style="font-size:10px"></span>
	</span><br>&nbsp;&nbsp;いつからか好きになっていました<br>中心藏之，何日忘之<br><br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice" target="_blank">PPOffice</a>
        </div>
    </div>
</footer>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?95a2d1c2cf767a8efae55252dd5e5de4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>